<div class="absolute inset-0 flex flex-col min-w-0 overflow-y-auto" cdkScrollable>
    <div class="flex min-w-0 flex-auto flex-col m-6">
        <div class="sticky top-0 z-50 flex items-center justify-between w-full py-2 px-2 md:px-4 transition-all duration-300 backdrop-blur-md"
            [ngClass]="{'bg-transparent': !scrolled, 'bg-white dark:bg-gray-900 shadow-md': scrolled }">
            <div class="text-3xl font-semibold italic leading-tight">
                {{hotel.nombre}}
            </div>
            <div class="flex justify-end mt-4 mb-2">
                <button mat-flat-button color="warn" class="mr-2" (click)="regresar()">
                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:arrow-left'"></mat-icon>
                    Regresar
                </button>
            </div>
        </div>
        <fuse-card class="filter-article flex w-full flex-col p-8">
            <mat-tab-group class="sm:px-2" mat-stretch-tabs="false" [animationDuration]="'0'">
                <mat-tab label="Descripcion">
                    <div class="mt-4 text-base leading-relaxed">
                        <p class="mb-4">{{ descripcionParrafo }}</p>
                    </div>
                    <button mat-flat-button color="primary" class="mr-2 text-white" (click)="abrirUbicacion()">
                        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                        Ubicación
                    </button>
                </mat-tab>

                <mat-tab label="Amenidades">
                    <ul class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 p-2">
                        <li *ngFor="let punto of descripcionLista"
                            class="flex items-center justify-center gap-2 text-center">
                            <mat-icon class="icon-size-5 text-green-600"
                                [svgIcon]="'heroicons_outline:check-badge'"></mat-icon>
                            <span>{{ punto }}</span>
                        </li>
                    </ul>
                </mat-tab>

            </mat-tab-group>
            <div>
            </div>
            <div class="mt-10">
                <div class="text-2xl my-4 font-semibold italic leading-tight text-center">
                    Galeria
                </div>
                @if(isScreenSmall){
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 p-2">
                    <div *ngFor="let imagen of imagenes" class="w-full h-40 bg-cover bg-center rounded-xl shadow-md"
                        [ngStyle]="{ 'background-image': 'url(' + imagen + ')' }"></div>
                </div>
                }
                @if(!isScreenSmall){

                <div #scrollContainer
                    class="scroll-container flex overflow-x-auto gap-4 p-4 pr-20 snap-x snap-mandatory cursor-grab active:cursor-grabbing select-none"
                    (scroll)="onScroll()" (mousedown)="startDrag($event)">

                    <div *ngFor="let imagen of hotel.imagenes; let i = index" (click)="seleccionarImagen(i, true)"
                        class="shrink-0 h-100 bg-cover bg-center shadow-md snap-center transition-all duration-300"
                        [ngStyle]="{
      'background-image': 'url(' + imagen + ')',
      'width.px': i === imagenSeleccionadaIndex ? 700 : 60,
      'border-radius': i === imagenSeleccionadaIndex ?'20px' : '50% / 10%'
    }" [attr.id]="'img-' + i">
                    </div>
                    <div style="flex: 0 0 400px;"></div>
                </div>
                }
            </div>
        </fuse-card>
    </div>
    <div class="sticky bottom-4 w-full z-50">
        <div class="relative flex justify-end pr-4">
            <!-- Tooltip fijo arriba del botón -->
            <div
                class="absolute bottom-16 right-0 whitespace-pre-line bg-gray-200 text-black font-semibold text-md px-3 py-1 rounded shadow animate-bounce text-center z-10">
                Solicita una<br>cotización
            </div>

            <!-- Botón de WhatsApp -->
            <button (click)="abrirModal()" aria-label="Enviar WhatsApp">
                <svg viewBox="0 0 256 259" width="60" height="60" xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="xMidYMid">
                    <path
                        d="m67.663 221.823 4.185 2.093c17.44 10.463 36.971 15.346 56.503 15.346 61.385 0 111.609-50.224 111.609-111.609 0-29.297-11.859-57.897-32.785-78.824-20.927-20.927-48.83-32.785-78.824-32.785-61.385 0-111.61 50.224-110.912 112.307 0 20.926 6.278 41.156 16.741 58.594l2.79 4.186-11.16 41.156 41.853-10.464Z"
                        fill="#00E676" />
                    <path
                        d="M219.033 37.668C195.316 13.254 162.531 0 129.048 0 57.898 0 .698 57.897 1.395 128.35c0 22.322 6.278 43.947 16.742 63.478L0 258.096l67.663-17.439c18.834 10.464 39.76 15.347 60.688 15.347 70.453 0 127.653-57.898 127.653-128.35 0-34.181-13.254-66.269-36.97-89.986ZM129.048 234.38c-18.834 0-37.668-4.882-53.712-14.648l-4.185-2.093-40.458 10.463 10.463-39.76-2.79-4.186C7.673 134.63 22.322 69.058 72.546 38.365c50.224-30.692 115.097-16.043 145.79 34.181 30.692 50.224 16.043 115.097-34.18 145.79-16.045 10.463-35.576 16.043-55.108 16.043Zm61.385-77.428-7.673-3.488s-11.16-4.883-18.136-8.371c-.698 0-1.395-.698-2.093-.698-2.093 0-3.488.698-4.883 1.396 0 0-.697.697-10.463 11.858-.698 1.395-2.093 2.093-3.488 2.093h-.698c-.697 0-2.092-.698-2.79-1.395l-3.488-1.395c-7.673-3.488-14.648-7.674-20.229-13.254-1.395-1.395-3.488-2.79-4.883-4.185-4.883-4.883-9.766-10.464-13.253-16.742l-.698-1.395c-.697-.698-.697-1.395-1.395-2.79 0-1.395 0-2.79.698-3.488 0 0 2.79-3.488 4.882-5.58 1.396-1.396 2.093-3.488 3.488-4.883 1.395-2.093 2.093-4.883 1.395-6.976-.697-3.488-9.068-22.322-11.16-26.507-1.396-2.093-2.79-2.79-4.883-3.488H83.01c-1.396 0-2.79.698-4.186.698l-.698.697c-1.395.698-2.79 2.093-4.185 2.79-1.395 1.396-2.093 2.79-3.488 4.186-4.883 6.278-7.673 13.951-7.673 21.624 0 5.58 1.395 11.161 3.488 16.044l.698 2.093c6.278 13.253 14.648 25.112 25.81 35.575l2.79 2.79c2.092 2.093 4.185 3.488 5.58 5.58 14.649 12.557 31.39 21.625 50.224 26.508 2.093.697 4.883.697 6.976 1.395h6.975c3.488 0 7.673-1.395 10.464-2.79 2.092-1.395 3.487-1.395 4.882-2.79l1.396-1.396c1.395-1.395 2.79-2.092 4.185-3.487 1.395-1.395 2.79-2.79 3.488-4.186 1.395-2.79 2.092-6.278 2.79-9.765v-4.883s-.698-.698-2.093-1.395Z"
                        fill="#FFF" />
                </svg>
            </button>
        </div>
    </div>
</div>

<div *ngIf="modalAbierto" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-6">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full relative max-h-[80vh] overflow-y-auto"
        style="box-sizing: border-box;">
        <button (click)="cerrarModal()" class="absolute top-2 right-3 text-gray-500 hover:text-red-600 text-3xl">
            &times;
        </button>

        <h2 class="text-2xl font-bold mb-4 text-green-800">Solicitar cotización</h2>

        <form [formGroup]="reservacionForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-green-700 mb-1">Adultos</label>
                <input type="number" formControlName="adultos" min="1"
                    class="block w-full rounded-lg border border-gray-300 px-4 py-2 text-sm shadow-sm focus:border-green-700 focus:ring focus:ring-green-200 focus:outline-none transition" />
            </div>

            <div>
                <label class="block text-sm font-medium text-green-700 mb-1">Niños</label>
                <input type="number" formControlName="ninos" min="0"
                    class="block w-full rounded-lg border border-gray-300 px-4 py-2 text-sm shadow-sm focus:border-green-700 focus:ring focus:ring-green-200 focus:outline-none transition" />
            </div>

            <div *ngFor="let edadControl of edadesNinos?.controls; let i = index" class="mb-4">
                <label class="block text-sm font-semibold text-green-700 mb-1">Edad del niño {{ i + 1 }}:</label>
                <select [formControl]="edadControl"
                    class="w-full px-4 py-2 text-sm border border-gray-300 rounded-lg shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-green-300 focus:border-green-700 transition">
                    <option *ngFor="let edad of [].constructor(18); let j = index" [value]="j">
                        {{ j }}
                    </option>
                </select>
            </div>

            <div class="space-y-0">
                <mat-form-field class="w-full" [formGroupName]="'rangoFechas'">
                    <mat-label class="block text-sm font-semibold text-green-700 mb-1">Rango de fechas</mat-label>

                    <mat-date-range-input [rangePicker]="picker" [dateFilter]="dateFilter">
                        <input matStartDate placeholder="Fecha inicio" formControlName="start" />
                        <input matEndDate placeholder="Fecha fin" formControlName="end" />
                    </mat-date-range-input>

                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                </mat-form-field>

                <div>
                    <label class="block text-sm font-medium text-green-700 mb-1">Noches</label>
                    <input type="number" formControlName="noches" min="1"
                        class="block w-full rounded-lg border border-gray-300 px-4 py-2 text-sm shadow-sm focus:border-green-700 focus:ring focus:ring-green-200 focus:outline-none transition" />
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-green-700 mb-1">Nombre</label>
                <input formControlName="nombre" min="1"
                    class="block w-full rounded-lg border border-gray-300 px-4 py-2 text-sm shadow-sm focus:border-green-700 focus:ring focus:ring-green-200 focus:outline-none transition" />
            </div>
            <div>
                <label class="block text-sm font-medium text-green-700 mb-1">Apellido</label>
                <input formControlName="apellido" min="1"
                    class="block w-full rounded-lg border border-gray-300 px-4 py-2 text-sm shadow-sm focus:border-green-700 focus:ring focus:ring-green-200 focus:outline-none transition" />
            </div>
        </form>
        <div class="mt-4 flex justify-end">
            <button mat-flat-button color="primary" [disabled]="reservacionForm.invalid"
                class="mr-2 flex items-center w-full text-white" (click)="abrirWhatsApp()">
                Solictar cotización por WhatsApp
            </button>
        </div>

    </div>
</div>

<div *ngIf="mostrarMapa" class="fixed inset-0 z-[999] bg-black/50 backdrop-blur-sm flex items-end justify-center">
  <div
    class="bg-white dark:bg-gray-900 w-4/5 max-h-[75%] rounded-t-2xl shadow-xl p-4 overflow-hidden animate-slide-up relative">
    
    <!-- Botón cerrar -->
    <button class="absolute top-2 right-4 text-gray-600 dark:text-gray-300" (click)="cerrarMapa()">
      <mat-icon svgIcon="heroicons_outline:x-mark" class="w-8 h-8"></mat-icon>
    </button>

    <!-- Contenido: Mapa -->
    <div class="text-center text-xl font-bold mb-4">Ubicación</div>
    <div class="w-full h-[400px] rounded-xl overflow-hidden">
      <app-mapa></app-mapa>
    </div>
  </div>
</div>